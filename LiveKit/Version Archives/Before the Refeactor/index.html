<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; connect-src 'self' ws: wss: https://cdn.jsdelivr.net http: https:; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; media-src 'self' blob:;">
  <title>The Cord</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="brand">
        <div class="brand-title">The Cord</div>
        <div class="brand-subtitle">Low-latency stream room</div>
      </div>
      <div class="header-actions">
        <label class="theme-toggle">
          <input id="themeToggle" type="checkbox">
          <span>Dark mode</span>
        </label>
      </div>
    </header>

    <div id="reconnectBanner" class="reconnect-banner">Reconnecting...</div>
    <div id="errorBanner" class="error-banner"></div>

    <main class="layout">
      <section class="panel controls">
        <div id="leftResizeHandle" class="resize-handle left-handle" role="separator" aria-orientation="vertical" aria-label="Resize controls panel"></div>
        <div id="roomAccessSection" class="section">
          <div class="section-header">
            <div id="connectionTitle" class="panel-title">Connection</div>
            <div class="connection-inline">
              <div id="connectionStatus" class="status-pill">Disconnected</div>
              <button id="leaveBtnIcon" class="btn icon-btn exit-btn" type="button" aria-label="Leave" title="Leave">
                <span class="icon door-icon" aria-hidden="true"></span>
              </button>
            </div>
          </div>
          <div class="room-access-fields">
            <div class="field">
              <label for="jwtInput">JWT token</label>
              <input id="jwtInput" placeholder="Paste token">
            </div>
            <div class="field">
              <label for="serverUrlInput">Server URL</label>
              <input id="serverUrlInput" placeholder="ws://your-livekit-server:7880">
            </div>
          </div>
          <div class="button-row">
            <button id="joinBtn" class="btn primary">Join</button>
          </div>
        </div>
        <div id="roomPreviewSection" class="section">
          <div class="section-header">
            <div class="panel-title">Participants</div>
            <span id="roomPreviewStatus" class="preview-status">Not checked</span>
          </div>
          <div id="roomPreviewList" class="preview-list"></div>
          <div id="participantsList" class="participants-list"></div>
        </div>

        <div class="section collapsible" data-collapsed="false" id="streamSetupSection">
          <div class="section-header">
            <div class="panel-title">Stream setup</div>
            <button class="btn ghost small collapse-toggle" type="button" aria-label="Toggle Stream setup">
              <span class="chevron" aria-hidden="true"></span>
            </button>
          </div>
          <div class="grid-2">
            <div class="field">
              <label for="resolutionSelect">Resolution</label>
              <select id="resolutionSelect">
                <option value="1280x720">720p</option>
                <option value="1920x1080" selected>1080p</option>
                <option value="2560x1440">1440p</option>
                <option value="3840x2160">4k</option>
              </select>
            </div>
            <div class="field">
              <label for="fpsSelect">FPS</label>
              <select id="fpsSelect">
                <option value="5">5</option>
                <option value="30">30</option>
                <option value="60" selected>60</option>
                <option value="120">120</option>
              </select>
            </div>
            <div class="field">
              <label for="bitrateInput">Max Bitrate (kbps)</label>
              <input id="bitrateInput" type="number" value="10000" />
            </div>
          <div class="field">
            <label for="sourceSelect">Source</label>
            <div class="inline">
              <select id="sourceSelect"></select>
            </div>
          </div>
        </div>
        <div class="button-row">
          <button id="startStreamBtn" class="btn primary">Start Stream</button>
          <button id="muteSystemBtn" class="btn icon-btn" type="button" aria-label="Mute System Audio" title="Mute System Audio">
            <span class="icon speaker-on" aria-hidden="true"></span>
          </button>
        </div>
      </div>

        <div class="section">
          <div class="section-header">
            <div class="panel-title">Audio devices</div>
            <button id="audioSettingsBtn" class="btn ghost small" type="button" aria-label="Audio settings" title="Audio settings">
              <span class="icon gear-icon" aria-hidden="true"></span>
            </button>
          </div>
          <div class="field">
            <label for="inputDeviceSelect">Input device</label>
            <div class="inline">
              <select id="inputDeviceSelect"></select>
            </div>
        </div>
        <div class="field">
          <label for="playbackDeviceSelect">Playback device</label>
          <div class="inline">
            <select id="playbackDeviceSelect"></select>
          </div>
        </div>
          <div class="button-row">
            <button id="muteMicBtn" class="btn icon-btn" type="button" aria-label="Mute Mic" title="Mute Mic">
              <span class="icon mic-on" aria-hidden="true"></span>
            </button>
            <button id="muteIncomingBtn" class="btn icon-btn" type="button" aria-label="Mute Incoming Audio" title="Mute Incoming Audio">
              <span class="icon headphones-on" aria-hidden="true"></span>
            </button>
          </div>
        </div>
      </section>

      <section class="panel stage">
        <div class="stage-header">
          <div class="panel-title">Live preview</div>
          <button id="theaterToggle" class="btn ghost small">Theater mode</button>
        </div>
        <div id="streamStatus" class="stream-status"></div>
        <div id="streams" class="streams"></div>
        <div id="minimizedPanel" class="minimized-panel">
          <div class="panel-title">Minimized</div>
          <div id="minimizedStreams" class="minimized-streams"></div>
        </div>
      </section>

      <section class="panel chat-panel">
        <div id="chatResizeHandle" class="resize-handle" role="separator" aria-orientation="vertical" aria-label="Resize chat panel"></div>
        <div id="chatDock" class="chat-dock">
          <div class="chat-header">
            <div class="panel-title">Chat</div>
            <div id="chatStatus" class="chat-status">Chat offline</div>
            <button id="chatCollapseBtn" class="btn ghost small collapse-toggle" type="button" aria-label="Toggle chat">
              <span class="chevron" aria-hidden="true"></span>
            </button>
          </div>
          <div class="chat-collapsed-label">Chat</div>
          <div id="chatLog" class="chat-log"></div>
          <div class="chat-input">
            <input id="chatInput" placeholder="Type a message">
            <button id="chatSendBtn" class="btn ghost small">Send</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="audioSettingsOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Audio Settings</div>
        <button id="audioSettingsClose" class="btn ghost small" type="button">Close</button>
      </div>
      <div class="modal-body">
        <button id="echoCancelBtn" class="btn ghost small">Echo Cancellation: On</button>
        <button id="noiseSuppressBtn" class="btn ghost small">Noise Suppression: On</button>
        <button id="noiseGateBtn" class="btn ghost small">Noise Gate: Off</button>
        <div class="audio-setting-row">
          <label for="noiseGateSlider">Gate Sensitivity</label>
          <div class="slider-row">
            <input id="noiseGateSlider" type="range" min="0" max="100" value="35">
            <span id="noiseGateValue" class="slider-value">35</span>
          </div>
        </div>
        <button id="enhancedVoiceBtn" class="btn ghost small">Enhanced Voice: Off</button>
        <div class="audio-setting-row">
          <label for="enhancedVoiceSlider">Enhanced Strength</label>
          <div class="slider-row">
            <input id="enhancedVoiceSlider" type="range" min="0" max="100" value="40">
            <span id="enhancedVoiceValue" class="slider-value">40</span>
          </div>
          <div class="audio-setting-hint">0 = natural, 100 = aggressive</div>
        </div>
        <div class="audio-setting-row">
          <label>Mute Mic Hotkey</label>
          <div class="slider-row">
            <button id="muteHotkeyBtn" class="btn ghost small" type="button">Set</button>
            <div id="muteHotkeyDisplay" class="hotkey-display">None</div>
          </div>
          <div class="audio-setting-hint">Press keys. Esc clears.</div>
        </div>
        <button id="autoGainBtn" class="btn ghost small">Auto Gain: On</button>
        <!-- Manual gain controls (disabled for now)
        <div id="manualGainRow" class="manual-gain-row">
          <label for="manualGainSlider">Manual Gain</label>
          <input id="manualGainSlider" type="range" min="0" max="300" value="100">
        </div>
        -->
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/livekit-client@2.15.0/dist/livekit-client.umd.js"></script>
  <script src="./renderer.js"></script>
</body>
</html>
